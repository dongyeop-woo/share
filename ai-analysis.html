<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>TradeNote | AI 분석</title>
    <link rel="stylesheet" href="assets/styles.css">
    <script src="assets/app.js" defer></script>
</head>
<body>
    <header class="site-header">
        <a href="dashboard.html" class="brand" style="text-decoration: none; color: inherit;">
            <span class="brand-mark" aria-hidden="true">📈</span>
            <div>
                <p class="brand-name">TradeNote</p>
                <p class="brand-tagline">쉽고 간단하게</p>
            </div>
        </a>
        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle" type="button" aria-label="테마 변경" title="다크모드/라이트모드 전환">
                <span class="theme-icon">⚙️</span>
            </button>
        </div>
    </header>

    <!-- 데스크탑 왼쪽 사이드 카테고리 -->
    <nav class="side-nav" aria-label="주요 카테고리">
        <a href="dashboard.html" class="side-nav__item">대시보드</a>
        <a href="index.html?view=journal" class="side-nav__item">매매일지</a>
        <a href="ai-analysis.html" class="side-nav__item active">AI 분석</a>
        <a href="calendar.html" class="side-nav__item">캘린더</a>
    </nav>

    <main>
        <section id="ai-analysis" class="content-section">
            <header class="section-header">
                <h2>AI 분석</h2>
                <p>당신의 매매 패턴을 AI가 분석하여 인사이트를 제공합니다.</p>
            </header>

            <!-- 로그인 필요 오버레이 -->
            <div class="login-block-overlay" id="login-overlay" aria-hidden="true">
                <div class="login-block-content" role="dialog" aria-labelledby="login-block-title" aria-describedby="login-block-desc">
                    <h3 id="login-block-title">로그인이 필요합니다</h3>
                    <p id="login-block-desc">AI 분석을 보려면 로그인해주세요.</p>
                    <a href="login.html" class="login-block-button" aria-label="로그인 페이지로 이동">로그인</a>
                </div>
            </div>

            <div id="ai-analysis-content" style="display: none;">
                <!-- 분석 선택 버튼 -->
                <div id="analysis-selection" class="analysis-selection">
                    <div class="analysis-btn-wrapper">
                        <button type="button" class="analysis-btn" id="loss-analysis-btn">
                            <span class="analysis-btn-text">손절 시 반복되는 문제점 찾기</span>
                        </button>
                        <button type="button" class="help-btn" id="loss-help-btn" title="이 기능에 대해 챗봇에게 물어보기">
                            <span>💬 도움말</span>
                        </button>
                    </div>
                    <div class="analysis-btn-wrapper">
                        <button type="button" class="analysis-btn" id="profit-analysis-btn">
                            <span class="analysis-btn-text">익절 시 반복되는 좋은 습관 찾기</span>
                        </button>
                        <button type="button" class="help-btn" id="profit-help-btn" title="이 기능에 대해 챗봇에게 물어보기">
                            <span>💬 도움말</span>
                        </button>
                    </div>
                    <div class="analysis-btn-wrapper">
                        <button type="button" class="analysis-btn" id="chart-analysis-btn">
                            <span class="analysis-btn-text">📈 차트 분석 (PVG, 상승/하락라인)</span>
                        </button>
                        <button type="button" class="help-btn" id="chart-help-btn" title="이 기능에 대해 챗봇에게 물어보기">
                            <span>💬 도움말</span>
                        </button>
                    </div>
                </div>

                <!-- 손절 문제점 분석 결과 -->
                <div id="loss-analysis-content" class="analysis-result" style="display: none;">
                    <button type="button" class="back-btn" id="back-from-loss">← 뒤로가기</button>
                    <div class="card-grid">
                        <div class="card">
                            <h3>손절 시 반복되는 문제점</h3>
                            <div id="loss-analysis-detail">
                                <p>분석을 시작하려면 버튼을 클릭하세요.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 익절 습관 분석 결과 -->
                <div id="profit-analysis-content" class="analysis-result" style="display: none;">
                    <button type="button" class="back-btn" id="back-from-profit">← 뒤로가기</button>
                    <div class="card-grid">
                        <div class="card">
                            <h3>익절 시 반복되는 좋은 습관</h3>
                            <div id="profit-analysis-detail">
                                <p>분석을 시작하려면 버튼을 클릭하세요.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 차트 분석 결과 -->
                <div id="chart-analysis-content" class="analysis-result" style="display: none;">
                    <button type="button" class="back-btn" id="back-from-chart">← 뒤로가기</button>
                    <div class="card-grid">
                        <div class="card">
                            <h3>차트 분석</h3>
                            <div id="chart-analysis-detail">
                                <div class="chart-upload-section">
                                    <label for="chart-image-input" class="chart-upload-label">
                                        <span>📷 차트 이미지 업로드</span>
                                        <input type="file" id="chart-image-input" accept="image/*" style="display: none;">
                                    </label>
                                    <div id="chart-image-preview" style="margin-top: 1rem; display: none;">
                                        <img id="chart-preview-img" style="max-width: 100%; max-height: 400px; border: 1px solid #ddd; border-radius: 8px;">
                                        <button type="button" id="remove-chart-image" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">이미지 제거</button>
                                    </div>
                                    <div style="margin-top: 1rem;">
                                        <label for="chart-symbol" style="display: block; margin-bottom: 0.5rem;">종목 심볼 (선택사항):</label>
                                        <input type="text" id="chart-symbol" placeholder="예: AAPL, TSLA" style="padding: 0.5rem; width: 200px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <button type="button" id="analyze-chart-btn" class="cta-button" style="margin-top: 1rem; padding: 0.75rem 2rem;" disabled>차트 분석 시작</button>
                                </div>
                                <div id="chart-analysis-result" style="margin-top: 2rem; display: none;">
                                    <div class="analysis-section">
                                        <h4>📊 분석 결과</h4>
                                        <div id="chart-analysis-text" style="white-space: pre-wrap; line-height: 1.6;"></div>
                                    </div>
                                    <div id="chart-analysis-summary" style="margin-top: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
                                        <h4>요약</h4>
                                        <div id="chart-summary-content"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 모바일 하단 바 카테고리 -->
    <nav class="bottom-nav" aria-label="하단 카테고리">
        <a href="index.html?view=journal" class="bottom-nav__item">매매일지</a>
        <a href="ai-analysis.html" class="bottom-nav__item active">AI 분석</a>
        <a href="calendar.html" class="bottom-nav__item">캘린더</a>
    </nav>

    <!-- 챗봇 위젯 -->
    <div class="chat-widget" id="chatbot">
        <div class="chat-widget__header">
            <div>
                <h3 class="chat-widget__title">AI 어시스턴트</h3>
                <p class="chat-widget__subtitle">AI 분석 기능에 대해 물어보세요</p>
            </div>
            <button type="button" class="chat-widget__toggle" id="chat-toggle" aria-label="챗봇 접기/펼치기">ㅡ</button>
        </div>
        <div class="chat-widget__body" id="chat-body">
            <div class="chat-message bot">
                <p class="chat-message__text">안녕하세요! AI 분석 기능에 대해 궁금한 점이 있으시면 언제든 물어보세요. 손절/익절 패턴 분석에 대해 설명해드릴 수 있습니다.</p>
            </div>
        </div>
        <form class="chat-widget__form" id="chat-form">
            <input type="text" class="chat-widget__input" id="chat-input" placeholder="메시지를 입력하세요..." autocomplete="off">
            <button type="submit">전송</button>
        </form>
    </div>
</body>
</html>

